function fillRoundRect(e,t,a,n,r,l,i){if(n<2*l||r<2*l)return!1;e.save(),e.translate(t,a),drawRoundRectPath(e,n,r,l),e.fillStyle=i||"#000",e.fill(),e.restore()}function strokeRoundRect(e,t,a,n,r,l,i,o){if(n<2*l||r<2*l)return!1;e.save(),e.translate(t,a),drawRoundRectPath(e,n,r,l),e.lineWidth=i||2,e.strokeStyle=o||"#000",e.stroke(),e.restore()}function drawRoundRectPath(e,t,a,n){e.beginPath(0),e.arc(t-n,a-n,n,0,Math.PI/2),e.lineTo(n,a),e.arc(n,a-n,n,Math.PI/2,Math.PI),e.lineTo(0,n),e.arc(n,n,n,Math.PI,3*Math.PI/2),e.lineTo(t-n,0),e.arc(t-n,n,n,3*Math.PI/2,2*Math.PI),e.lineTo(t,a-n),e.closePath()}function fillRoundRectPro(e,t,a,n,r,l,i,o,c,s){if(n<l+i||n<c+o||r<l+c||r<i+o)return!1;e.save(),e.translate(t,a),drawRoundRectPathPro(e,n,r,l,i,o,c),e.fillStyle=s||"#000",e.fill(),e.restore()}function drawRoundRectPathPro(e,t,a,n,r,l,i){e.beginPath(0),e.arc(t-l,a-l,l,0,Math.PI/2),e.lineTo(i,a),e.arc(i,a-i,i,Math.PI/2,Math.PI),e.lineTo(0,n),e.arc(n,n,n,Math.PI,3*Math.PI/2),e.lineTo(t-r,0),e.arc(t-r,r,r,3*Math.PI/2,2*Math.PI),e.lineTo(t,a-l),e.closePath()}function drawWave(t,a,n,r,l){for(let e=0;e<n.length;++e)fillRoundRect(t,4*e,(a-n[e])/2,2,n[e],r,l)}function drawWaveWhenPlaying(t,a,n,r,l,i,o){for(let e=0;e<r.length;++e)4*e+2<=n?fillRoundRect(t,4*e,(a-r[e])/2,2,r[e],l,i):4*e>=n?fillRoundRect(t,4*e,(a-r[e])/2,2,r[e],l,o):1<=n-4*e?(fillRoundRect(t,4*e,(a-r[e])/2,2,r[e],l,o),fillRoundRectPro(t,4*e,(a-r[e])/2,n-4*e,r[e],l,0,0,l,i)):(fillRoundRect(t,4*e,(a-r[e])/2,2,r[e],l,i),fillRoundRectPro(t,4*e,(a-r[e])/2,2-n+4*e,r[e],0,l,l,0,o))}function drawPlayLine(e,t,a,n){fillRoundRect(e,a,0,1,t,.1,n)}function createVoiceDom(a){for(let t=0;t<a.length;++t){let e=a[t];e.loop=!1;e.currentTime;isNaN(e.duration)||e.duration===1/0?e.addEventListener("durationchange",()=>{createWaveDom(e)}):createWaveDom(e)}}function createWaveDom(i){var o=i.parentElement;let c=o.querySelector("canvas");if(c.getContext("2d")){var s=i.duration,s=Math.floor(s),d=25<s+2?25:s+2;let e=o.querySelector(".pause-btn"),t=o.querySelector(".play-btn"),a=(o.querySelector(".voice-seconds").innerHTML=`${99<s?"..":s}"`,c.width=2*(2*d-1),c.height=23,[]);for(let e=0;e<d;++e){var h=(Math.floor(51*Math.random())+30)/100*c.height*.8;a.push(h)}var u=c.getContext("2d");let n="#333",r="#999",l=("dark"===stellar.dark.mode&&(n="#ccc",r="#707070"),!1);drawWave(u,c.height,a,1,n),i.addEventListener("timeupdate",()=>{0<i.currentTime&&(r="dark"===stellar.dark.mode?(n="#ccc","#707070"):(n="#333","#999"),u.clearRect(0,0,c.width,c.height),drawWaveWhenPlaying(u,c.height,i.currentTime/i.duration*c.width,a,1,n,r),drawPlayLine(u,c.height,i.currentTime/i.duration*c.width,n))}),i.addEventListener("ended",()=>{i.pause(),e.style.display="none",t.style.display="flex",i.currentTime=0,u.clearRect(0,0,c.width,c.height),drawWave(u,c.height,a,1,n),l=!1}),o.addEventListener("click",()=>{l="flex"===e.style.display?(i.pause(),e.style.display="none",!(t.style.display="flex")):(i.play(),e.style.display="flex",t.style.display="none",!0)}),stellar.dark.push(function(){l||(r="dark"===stellar.dark.mode?(n="#ccc","#707070"):(n="#333","#999"),0<i.currentTime?(drawWaveWhenPlaying(u,c.height,i.currentTime/i.duration*c.width,a,1,n,r),drawPlayLine(u,c.height,i.currentTime/i.duration*c.width,n)):drawWave(u,c.height,a,1,n))})}else console.log("浏览器不支持canvas")}function createCssStyle(e,t){var a=e.duration,n=Math.floor(a),r=25<n+2?25:n+2,l=e.parentElement;let i=l.querySelector(".pause-btn"),o=l.querySelector(".play-btn");l.querySelector(".voice-seconds").innerHTML=`${99<n?"..":n}"`;var c=2*(2*r-1),s=(25<n+2&&(l.style.width="100%"),document.createElement("div"));let d=document.createElement("div");d.className="play-line",s.append(d),s.className="voice-wave voice-wave-"+(t+1);for(let e=0;e<r;e++){var h=document.createElement("span");h.className="voice-wave-item",s.append(h)}l.insertBefore(s,l.querySelector(".voice-metas")),e.addEventListener("ended",()=>{e.pause(),i.style.display="none",o.style.display="flex",e.currentTime=0,d.classList.remove("active"),d.classList.add("back")}),l.addEventListener("click",()=>{"flex"===i.style.display?(e.pause(),i.style.display="none",o.style.display="flex",e.currentTime=0,d.classList.remove("active"),d.classList.add("back")):(e.play(),i.style.display="flex",o.style.display="none",d.classList.add("active"),d.classList.remove("back"))});let u=`
    .voice-wave.voice-wave-${t+1}>.play-line {
        transition: transform ${a}s linear;
        -moz-transition: transform ${a}s linear;
        -webkit-transition: transform ${a}s linear;
        -o-transition: transform ${a}s linear;
    }
    .voice-wave.voice-wave-${t+1}>.play-line.active {
        transform: translateX(${c}px);
    }
    `;for(let e=0;e<r;++e)u+=`
        .voice-wave-${t+1} span.voice-wave-item:nth-child(${e+1}) {
            height: ${10*(Math.floor(8*Math.random())+3)}%;
            margin-left: ${0==e?0:2}px;
        }
        `;n=document.createElement("style");n.setAttribute("type","text/css"),n.innerHTML=u,document.getElementsByTagName("head").item(0).appendChild(n)}